<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="date" content="2017-05-09" />

<title>Reproducing Exact Results from DMHEE</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Reproducing Exact Results from DMHEE</h1>
<h4 class="date"><em>2017-05-09</em></h4>


<div id="TOC">
<ul>
<li><a href="#hiv-model">HIV model</a></li>
<li><a href="#thr-model">THR model</a></li>
</ul>
</div>

<p>The purpose of this vignette is to present how to reproduce exactly the results from <a href="http://ukcatalogue.oup.com/product/9780198526629.do">Decision Modelling for Health Economic Evaluation</a>. While other vignettes such as <code>vignette(&quot;c-homogeneous&quot;, &quot;heemod&quot;)</code>, <code>vignette(&quot;d-non-homogeneous&quot;, &quot;heemod&quot;)</code> or <code>vignette(&quot;e-probabilistic&quot;, &quot;heemod&quot;)</code> are greatly inspired from this book, key elements differ (mostly for the sake of clarity) and thus results differ, sometimes significantly, from the book. Here we show how to exactly reproduce the results with the <code>heemod</code> package.</p>
<div id="hiv-model" class="section level1">
<h1>HIV model</h1>
<p>Key differences in DMHEE:</p>
<ol style="list-style-type: decimal">
<li>transitions occur at the end of each year,</li>
<li>cost are counted starting from year 1, not year 0,</li>
<li>treatment stops after 2 years,</li>
<li>rounding errors.</li>
</ol>
<p>It is possible to reproduce 1. and 2. by making transition happen at the <em>beginning</em> of each year (equivalent to transition happening at the <em>end</em> + ignoring the first year) with <code>method = &quot;beginning&quot;</code>. Since with this method the first year is actually the second, costs should be discounted from the start with the argument <code>first = TRUE</code> in <code>discount()</code>.</p>
<p>Point 3. is reproduced by making <code>rr</code> and <code>cost_lami</code> a time changing variable like this <code>rr = ifelse(markov_cycle &lt;= 2, .509, 1.00)</code>.</p>
<p>The last point is reproduced by writing transition probabilities as fractions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">par_mod &lt;-<span class="st"> </span><span class="kw">define_parameters</span>(
  <span class="dt">rr =</span> <span class="kw">ifelse</span>(markov_cycle &lt;=<span class="st"> </span><span class="dv">2</span>, .<span class="dv">509</span>, <span class="dv">1</span>),
  <span class="dt">cost_lami =</span> <span class="kw">ifelse</span>(markov_cycle &lt;=<span class="st"> </span><span class="dv">2</span>, <span class="fl">2086.5</span>, <span class="dv">0</span>),
  <span class="dt">cost_zido =</span> <span class="dv">2278</span>
)

mat_mono &lt;-<span class="st"> </span><span class="kw">define_transition</span>(
  <span class="dv">1251</span>/<span class="dv">1734</span>, <span class="dv">350</span>/<span class="dv">1734</span>, <span class="dv">116</span>/<span class="dv">1734</span>,  <span class="dv">17</span>/<span class="dv">1734</span>,
  <span class="dv">0</span>,         <span class="dv">731</span>/<span class="dv">1258</span>, <span class="dv">512</span>/<span class="dv">1258</span>,  <span class="dv">15</span>/<span class="dv">1258</span>,
  <span class="dv">0</span>,         <span class="dv">0</span>,        <span class="dv">1312</span>/<span class="dv">1749</span>, <span class="dv">437</span>/<span class="dv">1749</span>,
  <span class="dv">0</span>,         <span class="dv">0</span>,        <span class="dv">0</span>,         <span class="fl">1.00</span>
)</code></pre></div>
<pre><code>## No named state -&gt; generating names.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mat_comb &lt;-<span class="st"> </span><span class="kw">define_transition</span>(
  C, <span class="dv">350</span>/<span class="dv">1734</span>*rr, <span class="dv">116</span>/<span class="dv">1734</span>*rr, <span class="dv">17</span>/<span class="dv">1734</span>*rr,
  <span class="dv">0</span>, C,           <span class="dv">512</span>/<span class="dv">1258</span>*rr, <span class="dv">15</span>/<span class="dv">1258</span>*rr,
  <span class="dv">0</span>, <span class="dv">0</span>,           C,           <span class="dv">437</span>/<span class="dv">1749</span>*rr,
  <span class="dv">0</span>, <span class="dv">0</span>,           <span class="dv">0</span>,           <span class="fl">1.00</span>
)</code></pre></div>
<pre><code>## No named state -&gt; generating names.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">A_mono &lt;-<span class="st"> </span><span class="kw">define_state</span>(
  <span class="dt">cost_health =</span> <span class="dv">2756</span>,
  <span class="dt">cost_drugs =</span> cost_zido,
  <span class="dt">cost_total =</span> <span class="kw">discount</span>(
    cost_health +<span class="st"> </span>cost_drugs, .<span class="dv">06</span>, <span class="dt">first =</span> T),
  <span class="dt">life_year =</span> <span class="dv">1</span>
)
B_mono &lt;-<span class="st"> </span><span class="kw">define_state</span>(
  <span class="dt">cost_health =</span> <span class="dv">3052</span>,
  <span class="dt">cost_drugs =</span> cost_zido,
  <span class="dt">cost_total =</span> <span class="kw">discount</span>(
    cost_health +<span class="st"> </span>cost_drugs, .<span class="dv">06</span>, <span class="dt">first =</span> T),
  <span class="dt">life_year =</span> <span class="dv">1</span>
)
C_mono &lt;-<span class="st"> </span><span class="kw">define_state</span>(
  <span class="dt">cost_health =</span> <span class="dv">9007</span>,
  <span class="dt">cost_drugs =</span> cost_zido,
  <span class="dt">cost_total =</span> <span class="kw">discount</span>(
    cost_health +<span class="st"> </span>cost_drugs, .<span class="dv">06</span>, <span class="dt">first =</span> T),
  <span class="dt">life_year =</span> <span class="dv">1</span>
)
D_mono &lt;-<span class="st"> </span><span class="kw">define_state</span>(
  <span class="dt">cost_health =</span> <span class="dv">0</span>,
  <span class="dt">cost_drugs =</span> <span class="dv">0</span>,
  <span class="dt">cost_total =</span> <span class="kw">discount</span>(
    cost_health +<span class="st"> </span>cost_drugs, .<span class="dv">06</span>, <span class="dt">first =</span> T),
  <span class="dt">life_year =</span> <span class="dv">0</span>
)

A_comb &lt;-<span class="st"> </span><span class="kw">define_state</span>(
  <span class="dt">cost_health =</span> <span class="dv">2756</span>,
  <span class="dt">cost_drugs =</span> cost_zido +<span class="st"> </span>cost_lami,
  <span class="dt">cost_total =</span> <span class="kw">discount</span>(
    cost_health +<span class="st"> </span>cost_drugs, .<span class="dv">06</span>, <span class="dt">first =</span> T),
  <span class="dt">life_year =</span> <span class="dv">1</span>
)
B_comb &lt;-<span class="st"> </span><span class="kw">define_state</span>(
  <span class="dt">cost_health =</span> <span class="dv">3052</span>,
  <span class="dt">cost_drugs =</span> cost_zido +<span class="st"> </span>cost_lami,
  <span class="dt">cost_total =</span> <span class="kw">discount</span>(
    cost_health +<span class="st"> </span>cost_drugs, .<span class="dv">06</span>, <span class="dt">first =</span> T),
  <span class="dt">life_year =</span> <span class="dv">1</span>
)
C_comb &lt;-<span class="st"> </span><span class="kw">define_state</span>(
  <span class="dt">cost_health =</span> <span class="dv">9007</span>,
  <span class="dt">cost_drugs =</span> cost_zido +<span class="st"> </span>cost_lami,
  <span class="dt">cost_total =</span> <span class="kw">discount</span>(
    cost_health +<span class="st"> </span>cost_drugs, .<span class="dv">06</span>, <span class="dt">first =</span> T),
  <span class="dt">life_year =</span> <span class="dv">1</span>
)
D_comb &lt;-<span class="st"> </span><span class="kw">define_state</span>(
  <span class="dt">cost_health =</span> <span class="dv">0</span>,
  <span class="dt">cost_drugs =</span> <span class="dv">0</span>,
  <span class="dt">cost_total =</span> <span class="kw">discount</span>(
    cost_health +<span class="st"> </span>cost_drugs, .<span class="dv">06</span>, <span class="dt">first =</span> T),
  <span class="dt">life_year =</span> <span class="dv">0</span>
)

mod_mono &lt;-<span class="st"> </span><span class="kw">define_strategy</span>(
  <span class="dt">transition =</span> mat_mono,
  A_mono,
  B_mono,
  C_mono,
  D_mono
)</code></pre></div>
<pre><code>## No named state -&gt; generating names.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod_comb &lt;-<span class="st"> </span><span class="kw">define_strategy</span>(
  <span class="dt">transition =</span> mat_comb,
  A_comb,
  B_comb,
  C_comb,
  D_comb
)</code></pre></div>
<pre><code>## No named state -&gt; generating names.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">res_mod &lt;-<span class="st"> </span><span class="kw">run_model</span>(
  <span class="dt">mono =</span> mod_mono,
  <span class="dt">comb =</span> mod_comb,
  <span class="dt">parameters =</span> par_mod,
  <span class="dt">cycles =</span> <span class="dv">20</span>,
  <span class="dt">cost =</span> cost_total,
  <span class="dt">effect =</span> life_year,
  <span class="dt">method =</span> <span class="st">&quot;beginning&quot;</span>,
  <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)
)
<span class="kw">summary</span>(res_mod)</code></pre></div>
<pre><code>## 2 strategies run for 20 cycles.
## 
## Initial state counts:
## 
## A = 1
## B = 0
## C = 0
## D = 0
## 
## Counting method: 'beginning'.
## 
## Values:
## 
##      cost_health cost_drugs cost_total life_year
## mono    45541.24   18203.97   44663.45  7.991207
## comb    48082.83   24492.28   50601.65  8.937389
## 
## Efficiency frontier:
## 
## mono -&gt; comb
## 
## Differences:
## 
##      Cost Diff. Effect Diff.     ICER Ref.
## comb   5938.198    0.9461822 6275.956 mono</code></pre>
</div>
<div id="thr-model" class="section level1">
<h1>THR model</h1>
<p>Key difference in DMHEE:</p>
<ol style="list-style-type: decimal">
<li>Mortality rates are much higher in the book.</li>
</ol>
<p>This can be corrected by using a user-specified mortality table and then fetch the values with:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">look_up</span>(death_prob, <span class="dt">age =</span> age, <span class="dt">sex =</span> sex, <span class="dt">bin =</span> <span class="st">&quot;age&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># a function to return age-related mortality rate</span>
<span class="co"># given age and sex</span>
death_prob &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">age =</span> <span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">35</span>, <span class="dv">85</span>, <span class="dv">10</span>), <span class="dt">each =</span> <span class="dv">2</span>),
  <span class="dt">sex =</span> <span class="kw">rep</span>(<span class="dv">1</span>:<span class="dv">0</span>, <span class="dv">6</span>),
  <span class="dt">value =</span> <span class="kw">c</span>(
    <span class="fl">1.51e-3</span>, .<span class="fl">99e-3</span>, <span class="fl">3.93e-3</span>,
    <span class="fl">2.6e-3</span>, <span class="fl">10.9e-3</span>, <span class="fl">6.7e-3</span>,
    <span class="fl">31.6e-3</span>, <span class="fl">19.3e-3</span>, <span class="fl">80.1e-3</span>,
    <span class="fl">53.5e-3</span>, <span class="fl">187.9e-3</span>, <span class="fl">154.8e-3</span>
  )
)
death_prob</code></pre></div>
<pre><code>##    age sex   value
## 1   35   1 0.00151
## 2   35   0 0.00099
## 3   45   1 0.00393
## 4   45   0 0.00260
## 5   55   1 0.01090
## 6   55   0 0.00670
## 7   65   1 0.03160
## 8   65   0 0.01930
## 9   75   1 0.08010
## 10  75   0 0.05350
## 11  85   1 0.18790
## 12  85   0 0.15480</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">param &lt;-<span class="st"> </span><span class="kw">define_parameters</span>(
    <span class="dt">age_init =</span> <span class="dv">60</span>,
    <span class="dt">sex =</span> <span class="dv">0</span>,
    <span class="co"># age increases with cycles</span>
    <span class="dt">age =</span> age_init +<span class="st"> </span>markov_cycle,
    
    <span class="co"># operative mortality rates</span>
    <span class="dt">omrPTHR =</span> .<span class="dv">02</span>,
    <span class="dt">omrRTHR =</span> .<span class="dv">02</span>,
    
    <span class="co"># re-revision mortality rate</span>
    <span class="dt">rrr =</span> .<span class="dv">04</span>,
    
    <span class="co"># parameters for calculating primary revision rate</span>
    <span class="dt">cons =</span> -<span class="fl">5.49094</span>,
    <span class="dt">ageC =</span> -.<span class="dv">0367</span>,
    <span class="dt">maleC =</span> .<span class="dv">768536</span>,
    <span class="dt">lambda =</span> <span class="kw">exp</span>(cons +<span class="st"> </span>ageC *<span class="st"> </span>age_init +<span class="st"> </span>maleC *<span class="st"> </span>sex),
    <span class="dt">gamma =</span> <span class="fl">1.45367786</span>,
    
    <span class="dt">rrNP1 =</span> .<span class="dv">260677</span>,
    
    <span class="co"># revision probability of primary procedure</span>
    <span class="dt">standardRR =</span> <span class="dv">1</span> -<span class="st"> </span><span class="kw">exp</span>(lambda *<span class="st"> </span>((markov_cycle -<span class="st"> </span><span class="dv">1</span>) ^<span class="st"> </span>gamma -
<span class="st">                                     </span>markov_cycle ^<span class="st"> </span>gamma)),
    <span class="dt">np1RR =</span> <span class="dv">1</span> -<span class="st"> </span><span class="kw">exp</span>(lambda *<span class="st"> </span>rrNP1 *<span class="st"> </span>((markov_cycle -<span class="st"> </span><span class="dv">1</span>) ^<span class="st"> </span>gamma -<span class="st"> </span>
<span class="st">                                        </span>markov_cycle ^<span class="st"> </span>gamma)),
    
    <span class="co"># age-related mortality rate</span>
    <span class="dt">sex_cat =</span> <span class="kw">ifelse</span>(sex ==<span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;FMLE&quot;</span>, <span class="st">&quot;MLE&quot;</span>),
    <span class="dt">mr =</span> <span class="kw">look_up</span>(death_prob, <span class="dt">age =</span> age, <span class="dt">sex =</span> sex, <span class="dt">bin =</span> <span class="st">&quot;age&quot;</span>),
    
    <span class="dt">u_successP =</span> .<span class="dv">85</span>,
    <span class="dt">u_revisionTHR =</span> .<span class="dv">30</span>,
    <span class="dt">u_successR =</span> .<span class="dv">75</span>,
    <span class="dt">c_revisionTHR =</span> <span class="dv">5294</span>
)

mat_standard &lt;-<span class="st"> </span><span class="kw">define_transition</span>(
    <span class="dt">state_names =</span> <span class="kw">c</span>(
      <span class="st">&quot;PrimaryTHR&quot;</span>,
      <span class="st">&quot;SuccessP&quot;</span>,
      <span class="st">&quot;RevisionTHR&quot;</span>,
      <span class="st">&quot;SuccessR&quot;</span>,
      <span class="st">&quot;Death&quot;</span>
    ),
    <span class="dv">0</span>, C, <span class="dv">0</span>,          <span class="dv">0</span>, omrPTHR,
    <span class="dv">0</span>, C, standardRR, <span class="dv">0</span>, mr,
    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,          C, omrRTHR+mr,
    <span class="dv">0</span>, <span class="dv">0</span>, rrr,        C, mr,
    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,          <span class="dv">0</span>, <span class="dv">1</span>
)

mat_np1 &lt;-<span class="st"> </span><span class="kw">define_transition</span>(
    <span class="dt">state_names =</span> <span class="kw">c</span>(
      <span class="st">&quot;PrimaryTHR&quot;</span>,
      <span class="st">&quot;SuccessP&quot;</span>,
      <span class="st">&quot;RevisionTHR&quot;</span>,
      <span class="st">&quot;SuccessR&quot;</span>,
      <span class="st">&quot;Death&quot;</span>
    ),
    <span class="dv">0</span>, C, <span class="dv">0</span>,     <span class="dv">0</span>, omrPTHR,
    <span class="dv">0</span>, C, np1RR, <span class="dv">0</span>, mr,
    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,     C, omrRTHR+mr,
    <span class="dv">0</span>, <span class="dv">0</span>, rrr,   C, mr,
    <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>,     <span class="dv">0</span>, <span class="dv">1</span>
)

mod_standard &lt;-<span class="st"> </span><span class="kw">define_strategy</span>(
  <span class="dt">transition =</span> mat_standard,
  <span class="dt">PrimaryTHR =</span> <span class="kw">define_state</span>(
    <span class="dt">utility =</span> <span class="dv">0</span>,
    <span class="dt">cost =</span> <span class="dv">394</span>
  ),
  <span class="dt">SuccessP =</span> <span class="kw">define_state</span>(
    <span class="dt">utility =</span> <span class="kw">discount</span>(u_successP, .<span class="dv">015</span>),
    <span class="dt">cost =</span> <span class="dv">0</span>
  ),
  <span class="dt">RevisionTHR =</span> <span class="kw">define_state</span>(
    <span class="dt">utility =</span> <span class="kw">discount</span>(u_revisionTHR, .<span class="dv">015</span>),
    <span class="dt">cost =</span> <span class="kw">discount</span>(c_revisionTHR, .<span class="dv">06</span>)
  ),
  <span class="dt">SuccessR =</span> <span class="kw">define_state</span>(
    <span class="dt">utility =</span> <span class="kw">discount</span>(u_successR, .<span class="dv">015</span>),
    <span class="dt">cost =</span> <span class="dv">0</span>
  ),
  <span class="dt">Death =</span> <span class="kw">define_state</span>(
    <span class="dt">utility =</span> <span class="dv">0</span>,
    <span class="dt">cost =</span> <span class="dv">0</span>
  )
)

mod_np1 &lt;-<span class="st"> </span><span class="kw">define_strategy</span>(
  <span class="dt">transition =</span> mat_np1,
  <span class="dt">PrimaryTHR =</span> <span class="kw">define_state</span>(
    <span class="dt">utility =</span> <span class="dv">0</span>,
    <span class="dt">cost =</span> <span class="dv">579</span>
  ),
  <span class="dt">SuccessP =</span> <span class="kw">define_state</span>(
    <span class="dt">utility =</span> <span class="kw">discount</span>(u_successP, .<span class="dv">015</span>),
    <span class="dt">cost =</span> <span class="dv">0</span>
  ),
  <span class="dt">RevisionTHR =</span> <span class="kw">define_state</span>(
    <span class="dt">utility =</span> <span class="kw">discount</span>(u_revisionTHR, .<span class="dv">015</span>),
    <span class="dt">cost =</span> <span class="kw">discount</span>(c_revisionTHR, .<span class="dv">06</span>)
  ),
  <span class="dt">SuccessR =</span> <span class="kw">define_state</span>(
    <span class="dt">utility =</span> <span class="kw">discount</span>(u_successR, .<span class="dv">015</span>),
    <span class="dt">cost =</span> <span class="dv">0</span>
  ),
  <span class="dt">Death =</span> <span class="kw">define_state</span>(
    <span class="dt">utility =</span> <span class="dv">0</span>,
    <span class="dt">cost =</span> <span class="dv">0</span>
  )
)

res_mod &lt;-<span class="st"> </span><span class="kw">run_model</span>(
  <span class="dt">standard =</span> mod_standard,
  <span class="dt">np1 =</span> mod_np1,
  <span class="dt">parameters =</span> param,
  <span class="dt">cycles =</span> <span class="dv">60</span>,
  <span class="dt">cost =</span> cost,
  <span class="dt">effect =</span> utility,
  <span class="dt">method =</span> <span class="st">&quot;end&quot;</span>,
  <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>)
)
<span class="kw">summary</span>(res_mod)</code></pre></div>
<pre><code>## 2 strategies run for 60 cycles.
## 
## Initial state counts:
## 
## PrimaryTHR = 1
## SuccessP = 0
## RevisionTHR = 0
## SuccessR = 0
## Death = 0
## 
## Counting method: 'end'.
## 
## Values:
## 
##           utility     cost
## standard 14.65282 512.4474
## np1      14.69734 610.3152
## 
## Efficiency frontier:
## 
## standard -&gt; np1
## 
## Differences:
## 
##     Cost Diff. Effect Diff.     ICER     Ref.
## np1    97.8678   0.04451644 2198.464 standard</code></pre>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
